# politique-developpement-docker

[![Docker Pulls](https://img.shields.io/docker/pulls/abesesr/politique-developpement.svg)](https://hub.docker.com/r/abesesr/politique-developpement/)

Configuration docker üê≥ pour d√©ployer le site web https://politique-developpement.abes.fr  
Le code source et le contenu du site est disponible ici : https://github.com/abes-esr/politique-developpement

## URLs

Les URLs correspondantes aux d√©ploiements en local, dev, test et prod sont les suivantes :

- local :
    - http://127.0.0.1:8940/
    - http://127.0.0.1:3000/ (c'est l'URL par d√©faut lorsque l'on d√©marre docusaurus en mode d√©veloppement)
- dev :
    - https://politique-developpement-dev.abes.fr
    - http://diplotaxis6-dev.v212.abes.fr:8940/
- test :
    - https://politique-developpement-test.abes.fr
    - http://diplotaxis6-test.v202.abes.fr:8940/
- prod
    - https://politique-developpement.abes.fr
    - http://diplotaxis6-prod.v102.abes.fr:8940/

## Pr√©requis

Disposer de :
- ``docker``
- ``docker-compose``

## Installation

D√©ployer la configuration docker dans un r√©pertoire :
```bash
# adaptez /opt/pod/ avec l'emplacement o√π vous souhaitez d√©ployer l'application
cd /opt/pod/
git clone https://github.com/abes-esr/politique-developpement-docker.git
```

Configurer l'application depuis l'exemple du fichier [``.env-dist``](./.env-dist) (ce fichier contient la liste des variables avec des explications et des exemples de valeurs) :
```bash
cd /opt/pod/politique-developpement-docker/
cp .env-dist .env
# personnaliser alors le contenu du .env
```

D√©marrer l'application :
```bash
cd /opt/pod/politique-developpement-docker/
docker-compose up -d
```

## D√©marrage et arr√™t

```bash
# pour d√©marrer l'application (ou pour appliquer des modifications 
# faites dans /opt/pod/politique-developpement-docker/.env)
cd /opt/pod/politique-developpement-docker/
docker-compose up -d
```

Remarque : retirer le ``-d`` pour voir passer les logs dans le terminal et utiliser alors CTRL+C pour stopper l'application

```bash
# pour stopper l'application
cd /opt/pod/politique-developpement-docker/
docker-compose stop


# pour red√©marrer l'application
cd /opt/pod/politique-developpement-docker/
docker-compose restart
```

## Supervision

```bash
# pour visualiser les logs de l'appli
cd /opt/pod/politique-developpement-docker/
docker-compose logs -f --tail=100
```

Cela va afficher les 100 derni√®res lignes de logs g√©n√©r√©es par l'application et toutes les suivantes jusqu'au CTRL+C qui stoppera l'affichage temps r√©el des logs.


## Configuration

Pour configurer l'application, vous devez cr√©er et personnaliser un fichier ``/opt/pod/politique-developpement-docker/.env`` (cf section [Installation](#installation)). Les param√®tres √† placer dans ce fichier ``.env`` et des exemples de valeurs sont indiqu√©s dans le fichier [``.env-dist``](https://github.com/abes-esr/politique-developpement-docker/blob/develop/.env-dist)

## Sauvegardes

Les √©l√©ments suivants sont √† sauvegarder:
- ``/opt/pod/politique-developpement-docker/.env`` : contient la configuration sp√©cifique de notre d√©ploiement

### Restauration depuis une sauvegarde

R√©installez l'application politique-developpement depuis la [proc√©dure d'installation ci-dessus](#installation) et r√©cup√©r√© depuis les sauvegardes le fichier ``.env`` et placez-le dans ``/opt/pod/politique-developpement-docker/.env`` sur la machine qui doit faire repartir politique-developpement.

